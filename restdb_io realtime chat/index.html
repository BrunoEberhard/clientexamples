
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>upload</title>
    <script src="https://code.jquery.com/jquery-2.2.3.min.js"   integrity="sha256-a23g1Nt4dtEYOj7bR+vTu7+T8VP13humZFBJNIYoEJo="   crossorigin="anonymous"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0/jquery.min.js"></script>
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.10.0/lodash.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <!-- restdb.io libraries -->
    <script src="https://webforms-b553.restdb.local.io/assets/js/eventsource.min.js"></script>
    <script src="https://webforms-b553.restdb.local.io/rest/_jsapi.js"></script>
    
    <link rel="stylesheet" href="public/styles.css">
    <script src="public/code.js"></script>

</head>
<body>
    <div class="container-fluid">
        <h1>Realtime REST with restdb.io</h1>
        <div class="col-sm-4">
            <h2>Chat <small id="status" class="offline">offline</small></h2>
            <hr>
            <input type="text" id="oneliner">
            <div id="messages"></div>
        </div>
        <div class="col-sm-8">
            <h2>The code</h2>
            <hr>
            
            <pre id="init_block"><code class="javascript">  var apikey = &quot;570c0945f2eeca0bca106819&quot;;
    var db = null; 
    try {
        db = new restdb(&quot;570c0945f2eeca0bca106819&quot;, {realtime: true});
        $(&quot;#status&quot;).text(&quot;Ok, got the api&quot;).addClass(&quot;online&quot;);
    } catch (ex) {
        $(&quot;#status&quot;).text(&quot;Error loading jsapi&quot;);
    }
</code></pre>
    
<pre id="input_block"><code class="javascript"> $(&quot;#oneliner&quot;).keyup(function(e){
        if(e.keyCode == 13)
        {
            var payload = {&quot;oneliner&quot;: $(this).val()};
            $(this).val(&quot;&quot;);
            var newline = new db.chat(payload);
            newline.save();
        }
    });
</code></pre>

<pre id="post_block"><code class="javascript">  db.chat.on(&#39;POST&#39;, function(err, mess) {
        console.log(&quot;Realtime message: &quot;, mess);
        var line = $(&quot;&lt;div&gt;&quot;).text(mess.data.oneliner + &quot; &quot; + mess.data._id);
        line.hide();
        $(&quot;#messages&quot;).prepend(line);
        line.toggle(&quot;scale&quot;)
    });
</code></pre>

<pre id="put_block"><code class="javascript">  db.chat.on(&#39;PUT&#39;, function(err, mess) {
        db.chat.find({&quot;_id&quot;: mess.data}, {}, function(err, updatedline){
            $(&quot;#&quot;+mess.data).text(updatedline[0].oneliner);
        });
    });
</code></pre>

<pre id="delete_block"><code class="javascript">    // double click on text to delete
    db.chat.on(&#39;DELETE&#39;, function(err, mess) {
        _.each(mess.data, function(oneid){
            $(&quot;#&quot;+oneid).remove();    
        });
    });
</code></pre>

<pre id="connect_block"><code class="javascript">   db.on(&quot;CONNECT&quot;, function() {
        console.log(&quot;Realtime open: &quot;);
        $(&quot;#status&quot;).addClass(&quot;online&quot;).removeClass(&quot;offline&quot;).text(&quot;online&quot;);
        $(&quot;#messages&quot;).empty();
        db.chat.find({}, {&quot;$max&quot;: 100,&quot;$orderby&quot;: {&quot;_created&quot;: -1}}, function(err, lines){
            _.each(lines, function(aline){
                $(&quot;#messages&quot;).append($(&quot;&lt;div&gt;&quot;).text(aline.oneliner));        
            });
        })
    });
</code></pre>

<pre id="disconnect_block"><code class="javascript">    db.on(&quot;DISCONNECT&quot;, function() {
        console.log(&quot;Realtime closed: &quot;);
        $(&quot;#status&quot;).addClass(&quot;online&quot;).addClass(&quot;offline&quot;).text(&quot;off&quot;);
    });
</code></pre>

<pre id="recconnect_block"><code class="javascript">    db.on(&quot;RECONNECT&quot;, function() {
        $(&quot;#status&quot;).addClass(&quot;online&quot;).removeClass(&quot;offline&quot;).text(&quot;Back again&quot;);
    });
</code></pre>
        </div>
        
    </div>
</body>
</html>